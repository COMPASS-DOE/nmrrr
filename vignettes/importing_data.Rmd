---
title: "importing_data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{importing_data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(nmrrr)
```



This vignette represents the general workflow for processing NMR data using the *nmrrr* package. 

This package works only on processed data (e.g., phase-corrected, baseline-corrected, peak-picked, etc.). 
For tips on processing NMR data in MestreNova, check out the [repository wiki](https://github.com/kaizadp/nmrrr/wiki).

---

```{r}
library(tidyverse)
```


# testing with `kfp_hysteresis` data 



### Step 3. Set input directories

```{r}
SPECTRA_FILES = "inst/extdata/kfp_hysteresis/spectra_mnova"
PEAKS_FILES = "inst/extdata/kfp_hysteresis/peaks_mnova_multiple"
```

---

## PART II: Processing spectra files


`nmr_import_spectra`: 

This function will:

- import all the files from the SPECTRA_FILES location, 
- combine them into a single dataframe,
- clean the dataframe (??),
- and generate a dataframe with columns for ppm-shift, intensity, and sample-ID


```{r}
hyst_spectra_processed <- 
  nmr_import_spectra(path = SPECTRA_FILES,
                     method = "mnova") 


str(hyst_spectra_processed)
```


We want to keep only points between 0 and 10 ppm (user modification)
```{r}
hyst_spectra_processed_0_10  <-  
  hyst_spectra_processed %>%
  filter(ppm >= 0 & ppm <= 10)

str(hyst_spectra_processed_0_10)
```


---

## PART III: Plotting the spectra


`nmr_plot_spectra`
This function will plot all the spectra present in the `spectra_processed` file.

This is a basic ggplot format, and users can add additional customizations as needed

```{r}
nmr_plot_spectra(dat = hyst_spectra_processed_0_10,
                 binset = bins_Clemente2012,
                 label_position = 5,
                 mapping = aes(x = ppm, y = intensity, group = sampleID, color = sampleID),
                 stagger = 0.5) +
  labs(subtitle = "binset: Clemente et al. 2012")+
  ylim(0, 5.5)
```


The compound classes (bins) are labelled in the graph. Adjust the position (y-axis) using `LABEL_POSITION = ...`.

Overlaid spectra can be staggered along the y-axis using `STAGGER - ...`.

This function makes use of `ggplot2` capabilities, and the plot can therefore be customized using `ggplot2` nomenclature.

---


## PART IV: Processing peaks data

When exporting peaks data from MestreNova, the data are generally split across multiple columns.

The `import_nmr_peaks()` function will import the files in that format and then collapse all the columns for a single long-form dataframe.

```{r}
hyst_peaks_processed_mult = nmr_import_peaks(path = PEAKS_FILES, method = "multiple columns")

head(peaks_processed)

```

```{r}
hyst_peaks_processed_mult_bins = assign_compound_classes_v2(dat = peaks_processed_mult, BINSET = "Clemente")

```


**Note: The user may want to assign additional filtering steps to filter certain flagged data points, e.g. impurities, weak peaks, etc. ** 

For this current dataset, because of the strong influence of water peaks in the o-alkyl region, we exclude that region from our calculations.

```{r}
peaks_processed2 = 
  hyst_peaks_processed_mult_bins %>% 
  filter(group != "oalkyl")
```


---

## PART V: Exporting the processed data

The processed dataframes generated here can be exported using the usual R export functions, e.g. `write.csv()`, `write.table()`, etc.  


---

<details>
<summary>Session Info - click to open</summary>

Date run: `r Sys.Date()`


```{r, echo=FALSE}
sessionInfo()
```

</details>

---
